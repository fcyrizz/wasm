<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Video to MP3 Converter</title>
</head>
<body>
  <h2>Convert Video to MP3</h2>

  <input type="file" id="uploader" accept="video/*">
  <button id="convertBtn">Convert</button>
  <p id="status">Status: Idle</p>
  <a id="downloadLink" style="display:none;" download="output.mp3">Download MP3</a>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/ffmpeg/0.12.15/umd/ffmpeg.min.js"></script>
  <script>
    const { FFmpeg } = FFmpegWASM;

    // ✅ Tell ffmpeg where to fetch wasm/worker from
    const ffmpeg = new FFmpeg({
      coreURL: "https://cdnjs.cloudflare.com/ajax/libs/ffmpeg/0.12.15/umd/ffmpeg-core.js",
      wasmURL: "https://cdnjs.cloudflare.com/ajax/libs/ffmpeg/0.12.15/umd/ffmpeg-core.wasm",
      workerURL: "https://cdnjs.cloudflare.com/ajax/libs/ffmpeg/0.12.15/umd/ffmpeg-core.worker.js",
    });

    const uploader = document.getElementById("uploader");
    const convertBtn = document.getElementById("convertBtn");
    const statusEl = document.getElementById("status");
    const downloadLink = document.getElementById("downloadLink");

    async function loadFFmpeg() {
      statusEl.innerText = "Status: Loading ffmpeg...";
      await ffmpeg.load();
      statusEl.innerText = "Status: Ready";
    }
    loadFFmpeg();

    convertBtn.onclick = async () => {
      if (!uploader.files.length) {
        alert("Please select a video first");
        return;
      }

      const file = uploader.files[0];
      const inputName = file.name;
      const outputName = "output.mp3";

      statusEl.innerText = "Status: Writing file...";
      await ffmpeg.writeFile(inputName, new Uint8Array(await file.arrayBuffer()));

      statusEl.innerText = "Status: Converting...";
      await ffmpeg.exec(["-i", inputName, "-vn", "-ar", "44100", "-ac", "2", "-b:a", "192k", outputName]);

      statusEl.innerText = "Status: Fetching output...";
      const data = await ffmpeg.readFile(outputName);

      const blob = new Blob([data.buffer], { type: "audio/mpeg" });
      const url = URL.createObjectURL(blob);

      downloadLink.href = url;
      downloadLink.style.display = "inline-block";
      statusEl.innerText = "Status: Done ✅";
    };
  </script>
</body>
</html>
