<!DOCTYPE html>
<html>
<head>
  <title>Media to MP3 Converter</title>
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
</head>
<body>
  <h2>Convert media to MP3</h2>
  
  <input type="file" id="uploader" />
  <button id="convertBtn" disabled>Convert to MP3</button>
  <a id="downloadLink" style="display:none;" download="output.mp3">Download MP3</a>
  
  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });

    const uploader = document.getElementById('uploader');
    const convertBtn = document.getElementById('convertBtn');
    const downloadLink = document.getElementById('downloadLink');
    let file;

    uploader.addEventListener('change', (e) => {
      file = e.target.files[0];
      convertBtn.disabled = !file;
    });

    convertBtn.addEventListener('click', async () => {
      if (!ffmpeg.isLoaded()) {
        await ffmpeg.load();
      }

      // Write input file to FFmpeg FS
      ffmpeg.FS('writeFile', file.name, await fetchFile(file));

      // Run FFmpeg command: convert to mp3
      await ffmpeg.run('-i', file.name, 'output.mp3');

      // Read back the result
      const data = ffmpeg.FS('readFile', 'output.mp3');
      const blob = new Blob([data.buffer], { type: 'audio/mpeg' });
      const url = URL.createObjectURL(blob);

      downloadLink.href = url;
      downloadLink.style.display = 'inline-block';
    });
  </script>
</body>
</html>
