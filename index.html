<!DOCTYPE html>
<html>
<head>
  <title>Media to MP3 Converter</title>
</head>
<body>
  <h2>Convert media to MP3</h2>
  
  <input type="file" id="uploader" />
  <button id="convertBtn" disabled>Convert to MP3</button>
  <p id="status">Select a media file to begin.</p>
  <a id="downloadLink" style="display:none;" download="output.mp3">Download MP3</a>
  
  <script type="module">
    import { createFFmpeg, fetchFile } from "https://cdn.jsdelivr.net/npm/@ffmpeg.wasm/main@0.13.1/+esm";

    const ffmpeg = createFFmpeg({ log: true });
    const uploader = document.getElementById('uploader');
    const convertBtn = document.getElementById('convertBtn');
    const downloadLink = document.getElementById('downloadLink');
    const status = document.getElementById('status');
    let file;

    uploader.addEventListener('change', (e) => {
      file = e.target.files[0];
      if (file) {
        convertBtn.disabled = false;
        status.textContent = `‚úÖ File selected: ${file.name}`;
      } else {
        convertBtn.disabled = true;
        status.textContent = "‚ùå No file selected";
      }
    });

    convertBtn.addEventListener('click', async () => {
      try {
        status.textContent = "‚è≥ Loading FFmpeg...";
        if (!ffmpeg.isLoaded()) {
          await ffmpeg.load();
        }

        status.textContent = "‚è≥ Writing file into memory...";
        ffmpeg.FS('writeFile', file.name, await fetchFile(file));

        status.textContent = "üéµ Converting to MP3...";
        await ffmpeg.run('-i', file.name, 'output.mp3');

        status.textContent = "üìÇ Preparing download...";
        const data = ffmpeg.FS('readFile', 'output.mp3');
        const blob = new Blob([data.buffer], { type: 'audio/mpeg' });
        const url = URL.createObjectURL(blob);

        downloadLink.href = url;
        downloadLink.style.display = 'inline-block';
        status.textContent = "‚úÖ Conversion complete! Click download.";
      } catch (err) {
        console.error(err);
        status.textContent = "‚ùå Conversion failed: " + err.message;
      }
    });
  </script>
</body>
</html>
