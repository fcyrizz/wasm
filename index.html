<!DOCTYPE html>
<html>
<head>
  <title>Media to MP3 Converter</title>
</head>
<body>
  <h2>Convert media to MP3</h2>
  
  <input type="file" id="uploader" />
  <button id="convertBtn" disabled>Convert to MP3</button>
  <a id="downloadLink" style="display:none;" download="output.mp3">Download MP3</a>
  
  <script type="module">
    import { createFFmpeg, fetchFile } from "https://cdn.jsdelivr.net/npm/@ffmpeg.wasm/main@0.13.1/+esm";

    const ffmpeg = createFFmpeg({ log: true });
    const uploader = document.getElementById('uploader');
    const convertBtn = document.getElementById('convertBtn');
    const downloadLink = document.getElementById('downloadLink');
    let file;

    uploader.addEventListener('change', (e) => {
      file = e.target.files[0];
      convertBtn.disabled = !file;
    });

    convertBtn.addEventListener('click', async () => {
      if (!ffmpeg.isLoaded()) {
        await ffmpeg.load();
      }

      // write file to FS
      ffmpeg.FS('writeFile', file.name, await fetchFile(file));

      // convert
      await ffmpeg.run('-i', file.name, 'output.mp3');

      // read result
      const data = ffmpeg.FS('readFile', 'output.mp3');
      const blob = new Blob([data.buffer], { type: 'audio/mpeg' });
      const url = URL.createObjectURL(blob);

      downloadLink.href = url;
      downloadLink.style.display = 'inline-block';
    });
  </script>
</body>
</html>
